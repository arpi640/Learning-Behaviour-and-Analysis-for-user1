<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Message - Teacher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Teacher Dashboard</a>
            <div class="navbar-nav ms-auto">
                <span class="nav-link">Welcome, {{ current_user.username }}</span>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="p-3">
                    <h5>Navigation</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('teacher_dashboard') }}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('enrolled_students') }}">Enrolled Students</a>
                        </li>
						                        <li class="nav-item">
                            <a class="nav-link active" href="{{ url_for('manage_tests') }}">Manage Tests</a>
                        </li>
												{% for course in courses %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('manage_materials', course_id=course.id) }}">
                                {{ course.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 ms-sm-auto px-4 py-4">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title mb-0">Send Message to Student</h4>
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6>Recipient Information</h6>
                                <p><strong>Student:</strong> {{ student.full_name }}</p>
                                <p><strong>Email:</strong> {{ student.user.email }}</p>
                                <p><strong>Teacher:</strong> {{ teacher.full_name }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Enrolled Courses</h6>
                                <ul class="list-unstyled">
                                    {% for enrollment in student.enrollments %}
                                        {% if enrollment.course.teacher_id == teacher.id %}
                                        <li>â€¢ {{ enrollment.course.title }}</li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>

                        <form method="POST">
                            <div class="mb-3">
                                <label for="subject" class="form-label">Subject *</label>
                                <input type="text" class="form-control" id="subject" name="subject" required 
                                       placeholder="Enter message subject">
                            </div>
                            <div class="mb-3">
                                <label for="message" class="form-label">Message *</label>
                                <textarea class="form-control" id="message" name="message" rows="8" required 
                                          placeholder="Type your message to the student here..."></textarea>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sendEmail" name="send_email">
                                    <label class="form-check-label" for="sendEmail">
                                        Also send as email notification
                                    </label>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <small>
                                    <strong>Note:</strong> This message will be stored in the system and can be viewed by the student in their dashboard.
                                    If "Send as email" is checked, a copy will also be sent to the student's email address.
                                </small>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">Send Message</button>
                                <a href="{{ url_for('enrolled_students') }}" class="btn btn-secondary btn-lg">Cancel</a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Message Templates -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Quick Message Templates</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card template-card">
                                    <div class="card-body">
                                        <h6>Progress Check</h6>
                                        <p class="small">"How are you finding the course materials? Do you need any help?"</p>
                                        <button class="btn btn-sm btn-outline-primary use-template" data-template="progress">Use Template</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card template-card">
                                    <div class="card-body">
                                        <h6>Test Feedback</h6>
                                        <p class="small">"Great work on the recent test! Let me know if you want to review any concepts."</p>
                                        <button class="btn btn-sm btn-outline-primary use-template" data-template="feedback">Use Template</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card template-card">
                                    <div class="card-body">
                                        <h6>Encouragement</h6>
                                        <p class="small">"I've noticed your improvement. Keep up the good work and don't hesitate to ask questions!"</p>
                                        <button class="btn btn-sm btn-outline-primary use-template" data-template="encouragement">Use Template</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const templates = {
                progress: {
                    subject: "Checking on your course progress",
                    message: `Hello {{ student.full_name }},

I wanted to check how you're finding the course materials for our classes. Are there any topics you're finding challenging or any areas where you need additional help?

Please don't hesitate to reach out if you have any questions.

Best regards,
{{ teacher.full_name }}`
                },
                feedback: {
                    subject: "Feedback on your recent test",
                    message: `Hello {{ student.full_name }},

I wanted to provide some feedback on your recent test performance. You're making good progress!

If there are any specific areas you'd like to review or if you have questions about the test material, please let me know.

Best regards,
{{ teacher.full_name }}`
                },
                encouragement: {
                    subject: "Great work in the course!",
                    message: `Hello {{ student.full_name }},

I've been impressed with your progress and dedication in the course. Your consistent effort is really showing in your results!

Keep up the excellent work, and remember that I'm here to help if you need any support.

Best regards,
{{ teacher.full_name }}`
                }
            };

            document.querySelectorAll('.use-template').forEach(button => {
                button.addEventListener('click', function() {
                    const templateType = this.getAttribute('data-template');
                    const template = templates[templateType];
                    
                    document.getElementById('subject').value = template.subject;
                    document.getElementById('message').value = template.message;
                    
                    // Scroll to the form
                    document.getElementById('subject').scrollIntoView({ behavior: 'smooth' });
                });
            });
        });
    </script>
</body>
</html>